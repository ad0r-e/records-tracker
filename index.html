<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>records tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- chart.js for pie + line graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #050505;
      color: #f5f5f5;
    }
    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px;
    }
    h1, h2, h3 {
      font-weight: 600;
      text-transform: lowercase;
    }
    .card {
      background: #111;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 0 12px rgba(0,0,0,0.5);
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      text-transform: lowercase;
    }
    select, input[type="date"], button, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #181818;
      color: #f5f5f5;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      border: none;
      margin-top: 10px;
      background: linear-gradient(135deg, #ff7f50, #ffcc33);
      color: #000;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover {
      filter: brightness(1.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #333;
      text-align: left;
    }
    th {
      text-transform: lowercase;
      color: #bbbbbb;
    }
    .json-box {
      min-height: 160px;
      font-family: Menlo, ui-monospace, SFMono-Regular, monospace;
      font-size: 12px;
      white-space: pre;
    }
    .two-cols {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 800px) {
      .two-cols {
        grid-template-columns: 1fr 1fr;
      }
    }
    .btn-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }
    @media (min-width: 600px) {
      .btn-row {
        flex-direction: row;
      }
      .btn-row button {
        width: 50%;
      }
    }
    .status-small {
      font-size: 12px;
      color: #999;
      margin-top: 6px;
    }
  </style>
</head>
<body>
<div class="app">
  <h1>records tracker</h1>

  <!-- add record -->
  <div class="card">
    <h2>add record</h2>
    <label for="category">category</label>
    <select id="category">
      <option value="who asked">who asked</option>
      <option value="none of your business">none of your business</option>
      <option value="block">block</option>
      <option value="idc/idgaf">idc/idgaf</option>
      <option value="stfu">stfu</option>
      <option value="any insult">any insult</option>
    </select>

    <label for="date">date</label>
    <input id="date" type="date" />

    <button id="addBtn">add record</button>
    <p id="status" class="status-small"></p>
  </div>

  <!-- stats + records -->
  <div class="two-cols">
    <div class="card">
      <h2>stats</h2>
      <table id="statsTable">
        <thead>
        <tr>
          <th>category</th>
          <th>records</th>
          <th>dirhams (5 AED each)</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p id="totalAED" style="margin-top:8px;font-size:14px;"></p>
    </div>

    <div class="card">
      <h2>records list</h2>
      <table id="recordsTable">
        <thead>
        <tr>
          <th>date</th>
          <th>category</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- charts -->
  <div class="two-cols">
    <div class="card">
      <h2>pie chart</h2>
      <canvas id="pieChart" height="260"></canvas>
    </div>

    <div class="card">
      <h2>line chart</h2>
      <canvas id="lineChart" height="260"></canvas>
    </div>
  </div>

  <!-- json import / export -->
  <div class="card">
    <h2>json for chatgpt</h2>
    <div class="btn-row">
      <button id="exportBtn">export json</button>
      <button id="importBtn">import json (overwrite)</button>
    </div>
    <textarea id="jsonOutput" class="json-box" readonly></textarea>
    <p class="status-small">
      export: fills the box with json.  
      import: paste json into the box first, then press “import json” — this overwrites current records with the json data.
    </p>
  </div>
</div>

<script>
  const STORAGE_KEY = 'records_db_v1';

  const CATEGORIES = [
    'who asked',
    'none of your business',
    'block',
    'idc/idgaf',
    'stfu',
    'any insult'
  ];

  // record = { dateISO: '2025-11-18', category: 'who asked' }
  let records = loadRecords();

  const categorySelect = document.getElementById('category');
  const dateInput = document.getElementById('date');
  const addBtn = document.getElementById('addBtn');
  const statusEl = document.getElementById('status');
  const statsTableBody = document.getElementById('statsTable').querySelector('tbody');
  const recordsTableBody = document.getElementById('recordsTable').querySelector('tbody');
  const totalAEDEl = document.getElementById('totalAED');
  const exportBtn = document.getElementById('exportBtn');
  const importBtn = document.getElementById('importBtn');
  const jsonOutput = document.getElementById('jsonOutput');

  let pieChart, lineChart;

  function loadRecords() {
    try {
      const txt = localStorage.getItem(STORAGE_KEY);
      if (!txt) return [];
      return JSON.parse(txt);
    } catch (e) {
      console.error('failed to parse stored records', e);
      return [];
    }
  }

  function saveRecords() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
  }

  function isoToDisplay(iso) {
    // iso yyyy-mm-dd -> dd/MM/yyyy
    const [y, m, d] = iso.split('-');
    return `${d}/${m}/${y}`;
  }

  function displayToIso(ddmmyyyy) {
    const [d, m, y] = ddmmyyyy.split('/');
    return `${y}-${m}-${d}`;
  }

  function rebuildUI() {
    updateStats();
    updateRecordsTable();
    updateCharts();
    updateJsonOutput();
  }

  function updateStats() {
    const counts = {};
    CATEGORIES.forEach(c => counts[c] = 0);
    records.forEach(r => {
      counts[r.category] = (counts[r.category] || 0) + 1;
    });

    statsTableBody.innerHTML = '';
    let totalAED = 0;

    CATEGORIES.forEach(cat => {
      const c = counts[cat] || 0;
      const dirhams = c * 5;
      totalAED += dirhams;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${cat}</td>
        <td>${c}</td>
        <td>${dirhams} AED</td>
      `;
      statsTableBody.appendChild(tr);
    });

    totalAEDEl.textContent = `total: ${totalAED} AED`;
  }

  function updateRecordsTable() {
    const sorted = [...records].sort((a, b) => a.dateISO.localeCompare(b.dateISO));
    recordsTableBody.innerHTML = '';
    sorted.forEach(r => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${isoToDisplay(r.dateISO)}</td>
        <td>${r.category}</td>
      `;
      recordsTableBody.appendChild(tr);
    });
  }

  function groupedForJson() {
    const map = {};
    CATEGORIES.forEach(c => map[c] = []);
    records.forEach(r => {
      map[r.category].push(isoToDisplay(r.dateISO));
    });
    return map;
  }

  function updateJsonOutput() {
    const map = groupedForJson();
    let lines = ['{'];
    CATEGORIES.forEach((cat, idx) => {
      const dates = map[cat];
      lines.push(`  "${cat}": [`);
      dates.forEach((d, i) => {
        const comma = i < dates.length - 1 ? ',' : '';
        lines.push(`    "${d}"${comma}`);
      });
      const comma = idx < CATEGORIES.length - 1 ? '],' : ']';
      lines.push(`  ${comma}`);
    });
    lines.push('}');
    jsonOutput.value = lines.join('\n');
    // make editable for import
    jsonOutput.readOnly = false;
  }

  function computeCountsPerCategory() {
    const counts = {};
    CATEGORIES.forEach(c => counts[c] = 0);
    records.forEach(r => {
      counts[r.category] = (counts[r.category] || 0) + 1;
    });
    return counts;
  }

  function computeCountsPerDatePerCategory() {
    const datesSet = new Set();
    records.forEach(r => datesSet.add(r.dateISO));
    const dates = Array.from(datesSet).sort(); // iso order = chronological

    const data = {};
    CATEGORIES.forEach(cat => {
      data[cat] = dates.map(dateISO =>
        records.filter(r => r.category === cat && r.dateISO === dateISO).length
      );
    });

    return { dates, data };
  }

  function updateCharts() {
    // pie chart
    const counts = computeCountsPerCategory();
    const pieData = CATEGORIES.map(c => counts[c]);

    const ctxPie = document.getElementById('pieChart').getContext('2d');
    const colors = [
      '#a855f7',
      '#22c55e',
      '#3b82f6',
      '#f97316',
      '#eab308',
      '#ef4444'
    ];

    if (pieChart) pieChart.destroy();
    pieChart = new Chart(ctxPie, {
      type: 'pie',
      data: {
        labels: CATEGORIES,
        datasets: [{
          data: pieData,
          backgroundColor: colors,
          borderColor: '#000000',
          borderWidth: 2
        }]
      },
      options: {
        plugins: {
          legend: {
            labels: { color: '#f5f5f5', font: { size: 12 } }
          },
          title: {
            display: true,
            text: 'record distribution per category',
            color: '#f5f5f5',
            font: { size: 14 }
          }
        }
      }
    });

    // line chart
    const { dates, data } = computeCountsPerDatePerCategory();
    const ctxLine = document.getElementById('lineChart').getContext('2d');

    const dateLabels = dates.map(isoToDisplay);

    const lineDatasets = CATEGORIES.map((cat, idx) => ({
      label: cat,
      data: data[cat],
      borderColor: colors[idx % colors.length],
      backgroundColor: colors[idx % colors.length],
      tension: 0.2
    }));

    if (lineChart) lineChart.destroy();
    lineChart = new Chart(ctxLine, {
      type: 'line',
      data: {
        labels: dateLabels,
        datasets: lineDatasets
      },
      options: {
        scales: {
          x: {
            ticks: { color: '#f5f5f5' },
            title: {
              display: true,
              text: 'date',
              color: '#f5f5f5'
            }
          },
          y: {
            beginAtZero: true,
            ticks: { color: '#f5f5f5' },
            title: {
              display: true,
              text: 'number of records',
              color: '#f5f5f5'
            }
          }
        },
        plugins: {
          legend: {
            labels: { color: '#f5f5f5', font: { size: 11 } },
            title: { display: true, text: 'categories', color: '#f5f5f5' }
          },
          title: {
            display: true,
            text: 'records per date per category',
            color: '#f5f5f5',
            font: { size: 14 }
          }
        }
      }
    });
  }

  // add record
  addBtn.addEventListener('click', () => {
    const category = categorySelect.value;
    const dateISO = dateInput.value;

    if (!dateISO) {
      statusEl.textContent = 'please choose a date.';
      return;
    }

    records.push({ dateISO, category });
    saveRecords();
    rebuildUI();

    statusEl.textContent = `added ${isoToDisplay(dateISO)} → ${category}`;
    setTimeout(() => { statusEl.textContent = ''; }, 2000);
  });

  // export json
  exportBtn.addEventListener('click', () => {
    updateJsonOutput();
    statusEl.textContent = 'json exported below.';
    setTimeout(() => { statusEl.textContent = ''; }, 2000);
  });

  // import json (overwrite)
  importBtn.addEventListener('click', () => {
    const txt = jsonOutput.value.trim();
    if (!txt) {
      statusEl.textContent = 'paste json into the box first.';
      return;
    }
    let obj;
    try {
      obj = JSON.parse(txt);
    } catch (e) {
      statusEl.textContent = 'invalid json format.';
      return;
    }

    const newRecords = [];
    CATEGORIES.forEach(cat => {
      const arr = obj[cat];
      if (Array.isArray(arr)) {
        arr.forEach(d => {
          if (typeof d === 'string' && d.includes('/')) {
            const iso = displayToIso(d);
            newRecords.push({ dateISO: iso, category: cat });
          }
        });
      }
    });

    records = newRecords;
    saveRecords();
    rebuildUI();
    statusEl.textContent = 'json imported and records overwritten.';
    setTimeout(() => { statusEl.textContent = ''; }, 2500);
  });

  // init
  rebuildUI();
</script>
</body>
</html>
